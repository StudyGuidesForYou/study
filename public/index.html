<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Game Dashboard</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0;}
  body{font-family:"Roboto",Arial,sans-serif;background:#0f1116;color:#fff;overflow:hidden;}
  /* --- CLASS CODE --- */
  .container{background:#181a21;padding:40px;border-radius:16px;box-shadow:0 8px 25px rgba(0,0,0,0.6);text-align:center;width:350px;border:1px solid #23262f;transition:opacity 0.6s ease;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);}
  h1{margin-bottom:25px;font-size:24px;font-weight:600;color:#e8eaf0;}
  .code-boxes{display:flex;justify-content:space-between;margin-bottom:15px;}
  .code-input{width:50px;height:60px;font-size:28px;text-align:center;border:2px solid #30333b;border-radius:10px;outline:none;color:#f0f0f0;background:#111319;transition:all 0.2s;cursor:pointer;}
  .code-input:hover{border-color:#4b75ff;}
  .code-input:focus{border-color:#4b75ff;box-shadow:0 0 8px rgba(75,117,255,0.6);background:#161820;}
  button{cursor:pointer;transition:0.2s;font-weight:500;}
  /* --- MESSAGES & SPINNER --- */
  .spinner{margin-top:20px;width:40px;height:40px;border:4px solid #444;border-top-color:#4a6cf7;border-radius:50%;animation:spin 0.8s linear infinite;display:none;margin:auto;}
  @keyframes spin{from{transform:rotate(0deg);}to{transform:rotate(360deg);}}
  #loadedMsg{margin-top:20px;color:#7bff99;font-size:18px;font-weight:600;opacity:0;transition:opacity 0.5s ease;}
  #errorMsg{color:#ff4d4d;font-weight:600;margin-top:15px;opacity:0;transition:opacity 0.3s ease;}
  @keyframes shake{0%,100%{transform:translateX(0);}25%{transform:translateX(-5px);}50%{transform:translateX(5px);}75%{transform:translateX(-5px);}}
  .shake{animation:shake 0.3s;}
  /* --- DASHBOARD --- */
  #gamesScreen{position:absolute;top:0;left:0;width:100vw;height:100vh;background:#0f1116;color:white;opacity:0;pointer-events:none;transition:opacity 0.8s ease;padding:30px;overflow-y:auto;}
  #gamesScreen h2{font-size:28px;font-weight:700;text-align:center;margin-bottom:30px;color:#f0f0f0;}
  .games-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:25px;justify-items:center;}
  .game-card{background:#181b22;border:1px solid #252933;border-radius:12px;padding:15px;text-align:center;cursor:pointer;transition:all 0.25s ease;width:180px;}
  .game-card:hover{transform:translateY(-5px);border-color:#4b75ff;box-shadow:0 4px 15px rgba(75,117,255,0.3);}
  .game-card img{width:100%;height:110px;object-fit:cover;border-radius:10px;margin-bottom:10px;}
  .game-card p{font-size:15px;color:#e0e0e0;font-weight:500;}
  /* --- SETTINGS PANEL --- */
  #settingsBtn{position:absolute;top:15px;left:15px;background:#3a7afe;border:none;border-radius:8px;width:40px;height:40px;font-size:22px;z-index:1000;}
  #settingsBtn:hover{background:#2f4ac7;transform:scale(1.1);}
  #settingsPanel{position:fixed;top:60px;left:15px;width:220px;background:#181b22;border:1px solid #252933;border-radius:12px;padding:15px;display:none;flex-direction:column;gap:10px;z-index:1000;}
  #settingsPanel button{width:100%;padding:10px;background:#3a7afe;border:none;border-radius:8px;color:white;}
  #settingsPanel button:hover{background:#2f4ac7;transform:translateX(5px);}
  /* --- CHAT --- */
  #chatPanel{position:fixed;right:0;top:0;width:300px;height:100vh;background:#101217;border-left:1px solid #252933;display:none;flex-direction:column;z-index:999;}
  #chatMessages{flex:1;overflow-y:auto;padding:10px;}
  .chatMessage{margin-bottom:8px;font-size:14px;}
  #chatInput{display:flex;padding:10px;gap:5px;}
  #chatInput input{flex:1;padding:8px;border-radius:6px;border:none;background:#181b22;color:white;}
  #chatInput button{padding:8px 12px;background:#3a7afe;border:none;border-radius:6px;color:white;}
  /* --- GAME MODAL --- */
  #gameModal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);background:#101217;border-radius:15px;width:95vw;height:90vh;z-index:1000;display:flex;flex-direction:column;transition:transform 0.3s ease;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.7);}
  #gameModal.active{transform:translate(-50%,-50%) scale(1);}
  #gameFrame{width:100%;height:100%;border:none;background:#000;}
  .game-controls{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:#181b22;border-top:1px solid #252933;}
  .game-controls button{width:auto;padding:8px 14px;background:#3a7afe;border:none;border-radius:8px;color:white;}
  .game-controls button:hover{background:#2f4ac7;}
  #overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);opacity:0;pointer-events:none;transition:opacity 0.3s ease;z-index:900;}
  #overlay.active{opacity:1;pointer-events:all;}
</style>
</head>
<body>

<!-- CLASS CODE -->
<div class="container" id="codeBox">
<h1>Class Code?</h1>
<div class="code-boxes">
<input maxlength="1" class="code-input" id="c1" />
<input maxlength="1" class="code-input" id="c2" />
<input maxlength="1" class="code-input" id="c3" />
<input maxlength="1" class="code-input" id="c4" />
<input maxlength="1" class="code-input" id="c5" />
</div>
<button onclick="submitCode()">Continue</button>
<div id="errorMsg">Incorrect code. Try again.</div>
<div class="spinner" id="spinner"></div>
<div id="loadedMsg">Loaded!</div>
</div>

<!-- DASHBOARD -->
<div id="gamesScreen">
<h2>Browser Game Dashboard</h2>
<div class="games-grid" id="gamesGrid"></div>
</div>

<!-- SETTINGS -->
<button id="settingsBtn">⚙️</button>
<div id="settingsPanel">
<button id="signupBtn">Sign Up</button>
<button id="loginBtn">Log In</button>
<button id="chatBtn">Chat</button>
</div>

<!-- CHAT -->
<div id="chatPanel">
<div id="chatMessages"></div>
<div id="chatInput">
<input type="text" placeholder="Type a message..." id="chatText"/>
<button id="sendChatBtn">Send</button>
</div>
</div>

<!-- GAME MODAL -->
<div id="overlay"></div>
<div id="gameModal">
<iframe id="gameFrame" src="" allowfullscreen></iframe>
<div class="game-controls">
<button id="fullscreenBtn">⛶ Fullscreen</button>
<button id="gameLinkBtn">Game Link</button>
<button id="closeBtn">✕ Close</button>
</div>
</div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const validCodes=["44157","82693","90210"];
const games=[
{name:"2048",url:"https://play2048.co/",img:"https://upload.wikimedia.org/wikipedia/commons/0/09/2048_logo.png"},
{name:"Slow Roads",url:"https://slowroads.io/",img:"https://i.imgur.com/3df4LxE.png"},
{name:"Bloxd.io",url:"https://bloxd.io/",img:"https://i.imgur.com/IXq3V2y.png"},
{name:"Diep.io",url:"https://diep.io/",img:"https://i.imgur.com/nL6kzUX.png"},
{name:"Sandboxels",url:"https://sandboxels.r74n.com/",img:"https://i.imgur.com/rzITyRG.png"},
{name:"Jellymar.io",url:"https://jellymar.io/",img:"https://i.imgur.com/VbPwcMB.png"},
{name:"Chess.com",url:"https://www.chess.com/play",img:"https://images.chesscomfiles.com/uploads/v1/images_users/tiny_mce/ChessComStaff/phpR9T4kO.png"},
{name:"Invaders",url:"https://inv.nadeko.net/",img:"https://i.imgur.com/2Vq6HPO.png"},
{name:"GameSnacks",url:"https://gamesnacks.com/",img:"https://i.imgur.com/JkBzCKp.png"},
{name:"AddictingGames",url:"https://www.addictinggames.com/",img:"https://upload.wikimedia.org/wikipedia/commons/8/8c/Addicting_Games_logo.png"}
];

let inputs=document.querySelectorAll('.code-input');
let spinner=document.getElementById("spinner");
let loadedMsg=document.getElementById("loadedMsg");
let codeBox=document.getElementById("codeBox");
let gamesScreen=document.getElementById("gamesScreen");
let errorMsg=document.getElementById("errorMsg");
let modal=document.getElementById('gameModal');
let overlay=document.getElementById('overlay');
let gameFrame=document.getElementById('gameFrame');
let fullscreenBtn=document.getElementById('fullscreenBtn');
let closeBtn=document.getElementById('closeBtn');
let gameLinkBtn=document.getElementById('gameLinkBtn');
let settingsBtn=document.getElementById('settingsBtn');
let settingsPanel=document.getElementById('settingsPanel');
let chatBtn=document.getElementById('chatBtn');
let chatPanel=document.getElementById('chatPanel');
let chatMessages=document.getElementById('chatMessages');
let chatText=document.getElementById('chatText');
let sendChatBtn=document.getElementById('sendChatBtn');
let signupBtn=document.getElementById('signupBtn');
let loginBtn=document.getElementById('loginBtn');

let currentGameUrl=null;
let socket=null;
let username=null;
let token=null;

// --- CLASS CODE ---
inputs.forEach((input,index)=>{
input.addEventListener('input',()=>{if(input.value.length===1 && index<inputs.length-1) inputs[index+1].focus();});
input.addEventListener('keydown',(e)=>{if(e.key==='Backspace' && input.value==='' && index>0) inputs[index-1].focus(); if(e.key==='Enter') submitCode();});
});
inputs[0].focus();

function submitCode(){
let code=Array.from(inputs).map(i=>i.value).join('');
if(!validCodes.includes(code)){
errorMsg.style.opacity=1;
codeBox.classList.add('shake');
setTimeout(()=>codeBox.classList.remove('shake'),300);
inputs.forEach(i=>i.value=''); inputs[0].focus();
return;
}
errorMsg.style.opacity=0;
spinner.style.display="block";
setTimeout(()=>{
spinner.style.display="none";
loadedMsg.style.opacity=1;
setTimeout(()=>{
codeBox.style.opacity=0;
setTimeout(()=>{
codeBox.style.display="none";
gamesScreen.style.opacity=1;
gamesScreen.style.pointerEvents="auto";
settingsBtn.style.display="block";
},600);
},1200);
},1500);
}

// --- SETTINGS ---
settingsBtn.addEventListener('click',()=>{settingsPanel.style.display=(settingsPanel.style.display==='flex')?'none':'flex';});

// --- CHAT ---
chatBtn.addEventListener('click',()=>{chatPanel.style.display=(chatPanel.style.display==='flex')?'none':'flex';});

// --- Populate games ---
const gamesGrid=document.getElementById('gamesGrid');
games.forEach(g=>{
let card=document.createElement('div'); card.className='game-card';
card.dataset.url=g.url;
card.innerHTML=`<img src="${g.img}" alt="${g.name}"><p>${g.name}</p>`;
gamesGrid.appendChild(card);
});

// --- GAME MODAL ---
document.querySelectorAll('.game-card').forEach(card=>{
card.addEventListener('click',()=>{
currentGameUrl=card.dataset.url;
gameFrame.src=currentGameUrl;
modal.classList.add('active');
overlay.classList.add('active');
});
});

closeBtn.addEventListener('click',closeModal);
overlay.addEventListener('click',closeModal);

fullscreenBtn.addEventListener('click',()=>{if(!document.fullscreenElement) modal.requestFullscreen(); else document.exitFullscreen();});
gameLinkBtn.addEventListener('click',()=>{if(currentGameUrl) window.open(currentGameUrl,'_blank');});

function closeModal(){modal.classList.remove('active');overlay.classList.remove('active');gameFrame.src='';if(document.fullscreenElement) document.exitFullscreen();}

// --- SOCKET.IO CHAT ---
function initSocket(){
socket=io();
socket.on('chat-history',msgs=>{chatMessages.innerHTML='';msgs.forEach(m=>addChatMessage(m));chatMessages.scrollTop=chatMessages.scrollHeight;});
socket.on('chat-message',m=>{addChatMessage(m);chatMessages.scrollTop=chatMessages.scrollHeight;});
}

function addChatMessage(msg){
const div=document.createElement('div'); div.className='chatMessage';
div.textContent=`${msg.username}: ${msg.text}`;
chatMessages.appendChild(div);
}

sendChatBtn.addEventListener('click',()=>{
const text=chatText.value.trim(); if(!text) return; chatText.value='';
if(socket) socket.emit('chat-message',{text});
});

initSocket();

// --- SIGN UP / LOGIN ---
signupBtn.addEventListener('click',async ()=>{
let uname=prompt("Username:"); if(!uname) return;
let pwd=prompt("Password:"); if(!pwd) return;
try{
let res=await fetch('/api/signup',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:uname,password:pwd})});
let data=await res.json();
if(data.token){token=data.token; username=data.user.username; alert("Signed up as "+username);}
else alert(data.error);
}catch(e){alert("Error: "+e);}
});

loginBtn.addEventListener('click',async ()=>{
let uname=prompt("Username:"); if(!uname) return;
let pwd=prompt("Password:"); if(!pwd) return;
try{
let res=await fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:uname,password:pwd})});
let data=await res.json();
if(data.token){token=data.token; username=data.user.username; alert("Logged in as "+username);}
else alert(data.error);
}catch(e){alert("Error: "+e);}
});

</script>
</body>
</html>
