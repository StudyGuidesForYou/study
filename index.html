<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Advanced Ball Sim</title>
<style>
  body {
    margin: 0;
    background: black;
    color: white;
    font-family: Arial, sans-serif;
    overflow: hidden;
  }
  #ui {
    position: fixed;
    top: 10px;
    right: 10px;
    background: rgba(20,20,20,0.7);
    padding: 15px;
    border-radius: 12px;
    backdrop-filter: blur(10px);
  }
  button, select {
    width: 150px;
    margin: 5px 0;
    padding: 6px;
    font-size: 15px;
    border-radius: 8px;
    border: none;
    background: #222;
    color:white;
    cursor: pointer;
  }
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="ui">
  <button id="addBallBtn">Add Ball</button>
  <button id="toggleCamBtn">Toggle Cam Follow</button>
  <select id="mode">
    <option value="none">Low Quality (No Gravity)</option>
    <option value="gravity">Gravity</option>
    <option value="blackhole">Gravity Ball</option>
    <option value="double">Double Trouble</option>
  </select>
</div>
<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
let w, h, cx, cy, radius;
function resize(){
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
  cx = w/2; cy = h/2;
  radius = Math.min(w,h)*0.4;
}
window.onresize = resize; resize();

class Ball{
  constructor(){
    this.reset();
  }
  reset(){
    this.x = cx + (Math.random()*2-1)*50;
    this.y = cy + (Math.random()*2-1)*50;
    const a = Math.random()*Math.PI*2;
    const s = 3 + Math.random()*2;
    this.vx = Math.cos(a)*s;
    this.vy = Math.sin(a)*s;
    this.trail=[];
  }
  update(){
    const mode = modeSel.value;

    // Gravity downward
    if(mode=="gravity"){
      this.vy += 0.15;
    }

    // Black hole gravity
    if(mode=="blackhole"){
      const dx = blackhole.x - this.x;
      const dy = blackhole.y - this.y;
      const d = Math.sqrt(dx*dx+dy*dy);
      const g = Math.min(50, 2000/(d*d+50)); // prevent crazy speed
      this.vx += dx/d*g;
      this.vy += dy/d*g;
      // optional damping
      this.vx *= 0.99;
      this.vy *= 0.99;
    }

    this.x += this.vx;
    this.y += this.vy;

    // Circle boundary collision
    const dx = this.x - cx;
    const dy = this.y - cy;
    const dist = Math.sqrt(dx*dx + dy*dy);

    if(dist > radius){
      const nx = dx/dist;
      const ny = dy/dist;
      const dot = this.vx*nx + this.vy*ny;
      this.vx -= 2*dot*nx;
      this.vy -= 2*dot*ny;

      if(mode=="double"){
        // double the total balls
        let current = balls.length;
        for(let i=0;i<current;i++){
          spawnBall();
        }
      }
    }

    this.trail.push({x:this.x,y:this.y});
    if(this.trail.length>50) this.trail.shift();
  }
  draw(){
    for(let i=1;i<this.trail.length;i++){
      const p = this.trail[i];
      ctx.beginPath();
      ctx.arc(p.x,p.y,3,0,Math.PI*2);
      ctx.fillStyle=`hsla(${i*3},100%,50%,0.3)`;
      ctx.fill();
    }
    ctx.beginPath();
    ctx.arc(this.x,this.y,10,0,Math.PI*2);
    ctx.fillStyle = "lime";
    ctx.fill();
  }
}

let balls=[new Ball()];
function spawnBall(){balls.push(new Ball());}

let camFollow=false;
let glow=0;
let modeSel=document.getElementById("mode");

// black hole orbit
const blackhole={angle:0,x:0,y:0};

// Reset balls when mode changes
modeSel.onchange = ()=>{
  balls=[new Ball()];
}

function loop(){
  requestAnimationFrame(loop);
  ctx.clearRect(0,0,w,h);

  if(glow>0.05) glow*=0.9; else glow=0.05;

  const mode = modeSel.value;

  // Black hole orbit
  if(mode=="blackhole"){
    blackhole.angle += 0.01;
    blackhole.x = cx + Math.cos(blackhole.angle)*(radius+50); // orbit outside
    blackhole.y = cy + Math.sin(blackhole.angle)*(radius+50);
    ctx.beginPath();
    let grad = ctx.createRadialGradient(blackhole.x,blackhole.y,5,blackhole.x,blackhole.y,25);
    grad.addColorStop(0,"white");
    grad.addColorStop(1,"rgba(255,255,255,0)");
    ctx.fillStyle=grad;
    ctx.arc(blackhole.x,blackhole.y,15,0,Math.PI*2);
    ctx.fill();
  }

  // Camera
  let camX=0, camY=0;
  if(camFollow && balls.length>0){
    camX = cx - balls[0].x;
    camY = cy - balls[0].y;
  }
  ctx.save();
  ctx.translate(camX, camY);

  // Outer circle
  ctx.beginPath();
  ctx.arc(cx, cy, radius, 0, Math.PI*2);
  ctx.strokeStyle=`rgba(0,255,0,${glow})`;
  ctx.lineWidth=5;
  ctx.stroke();

  // Update & draw all balls
  for(const b of balls){ b.update(); b.draw(); }

  ctx.restore();
}
loop();

// UI buttons
addBallBtn.onclick=()=>spawnBall();
toggleCamBtn.onclick=()=>camFollow=!camFollow;
</script>
</body>
</html>
